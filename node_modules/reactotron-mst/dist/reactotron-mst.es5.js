import{getType,onSnapshot,addMiddleware,getPath,isAlive,isRoot,isProtected,getSnapshot,applySnapshot,applyAction}from"mobx-state-tree";import"reactotron-core-client";import{has,replace,pipe,map,when,isNil,always,filter,endsWith,slice,path,split,is,isEmpty,keys,concat,flatten,reject,uniq,sortBy,identity}from"ramda";var dotPath=function(a,b){return path(split(".",a),b)},isNilOrEmpty=function(a){return isNil(a)||isEmpty(a)},isReactNativeEvent=function(a){return"undefined"!=typeof a&&null!==a&&has("nativeEvent",a)&&has("target",a)&&has("type",a)},convertUnsafeArguments=function(a){var b=Array.isArray(a)?a:[a];return b.map(function(a){return isReactNativeEvent(a)?"ReactNativeEvent":a})};function mst(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return function(b){function c(a,c){onSnapshot(a,d),addMiddleware(a,function(d,e){var g="action"!==d.type;if(g)return e(d);var i=h(d);if(!i)return e(d);var j=convertUnsafeArguments(d.args),k=getPath(d.context),l={args:j,name:d.name,path:k},m={id:d.id,parentId:d.parentId,rootId:d.rootId,type:d.type,modelType:getType(a),alive:isAlive(a),root:isRoot(a),protected:isProtected(a)},n=b.startTimer(),o=e(d),p=n(),q=replace(/^\./,"",replace(/\//g,".",k)),r=replace(/^\./,"","".concat(c?c:"").concat(q,".").concat(d.name,"()"));return r=replace("/",".",r),f||b.send("state.action.complete",{name:r,action:l,mst:m,ms:p}),o})}function d(a){var c=pipe(map(when(isNil,always(""))),filter(endsWith(".*")),map(function(b){var c=slice(0,-2,b),d=dotPath(c,a);return is(Object,d)&&!isNilOrEmpty(d)?pipe(keys,map(function(a){return"".concat(c,".").concat(a)}))(d||{}):[]}),concat(map(when(isNil,always("")),g)),flatten,reject(endsWith(".*")),uniq,sortBy(identity),map(function(b){return{path:b,value:isNilOrEmpty(b)?a:dotPath(b,a)}}))(g);b.stateValuesChange(c)}var e={},f=!1,g=[],h=a.filter?a.filter:function(){return!0},i={"state.backup.request":function(a){var c=e[a.mstNodeName||"default"];if(c&&c.node){var d=getSnapshot(c.node);b.send("state.backup.response",{state:d})}},"state.restore.request":function(a){var b=e[a.mstNodeName||"default"],c=a&&a.payload&&a.payload.state;if(b&&b.node){var d=b.node;f=!0,applySnapshot(d,c),f=!1}},"state.action.dispatch":function(a){var b=e[a.mstNodeName||"default"],c=a&&a.payload&&a.payload.action;if(b&&b.node&&c){var d=b.node;try{applyAction(d,c)}catch(a){}}},"state.values.subscribe":function(b){var c=e[b.mstNodeName||"default"],f=b&&b.payload&&b.payload.paths||[];if(f&&(g=uniq(flatten(f))),c&&c.node){var h="snapshot"===a.queryMode?getSnapshot(c.node):c.node;d(h)}},"state.keys.request":function(a){var c=e[a.mstNodeName||"default"],d=a&&a.payload&&a.payload.path||[];if(c&&c.node&&d){var f=getSnapshot(c.node);if(isNilOrEmpty(d))b.stateKeysResponse(null,keys(f));else{var g=keys(dotPath(d,f));b.stateKeysResponse(d,g)}}},"state.values.request":function(a){var c=e[a.mstNodeName||"default"],d=a&&a.payload&&a.payload.path||[];if(c&&c.node&&d){var f=getSnapshot(c.node);isNilOrEmpty(d)?b.stateValuesResponse(null,f):b.stateValuesResponse(d,dotPath(d,f))}}};return{onCommand:function(a){var b=i[a&&a.type];b&&b(a)},features:{trackMstNode:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"default";if(!a)return{kind:"required"};if(e[b])return{kind:"already-tracking"};try{var d=getType(a);if(d.isType)try{return c(a),e[b]={node:a,modelType:d},{kind:"ok"}}catch(a){return{kind:"tracking-error",message:a.message}}else return{kind:"invalid-node"}}catch(a){return{kind:"invalid-node"}}}}}}}export{mst};
//# sourceMappingURL=reactotron-mst.es5.js.map
