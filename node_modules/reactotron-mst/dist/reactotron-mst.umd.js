(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("mobx-state-tree"),require("reactotron-core-client"),require("ramda")):"function"==typeof define&&define.amd?define(["exports","mobx-state-tree","reactotron-core-client","ramda"],b):(a=a||self,b(a.reactotronMst={},a.mobxStateTree,a.reactotronCoreClient,a.ramda))})(this,function(a,b,c,d){'use strict';var e=function(a,b){return d.path(d.split(".",a),b)},f=function(a){return d.isNil(a)||d.isEmpty(a)},g=function(a){return"undefined"!=typeof a&&null!==a&&d.has("nativeEvent",a)&&d.has("target",a)&&d.has("type",a)},h=function(a){var b=Array.isArray(a)?a:[a];return b.map(function(a){return g(a)?"ReactNativeEvent":a})};a.mst=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return function(c){function g(a,e){b.onSnapshot(a,i),b.addMiddleware(a,function(f,g){var i="action"!==f.type;if(i)return g(f);var j=m(f);if(!j)return g(f);var l=h(f.args),n=b.getPath(f.context),o={args:l,name:f.name,path:n},p={id:f.id,parentId:f.parentId,rootId:f.rootId,type:f.type,modelType:b.getType(a),alive:b.isAlive(a),root:b.isRoot(a),protected:b.isProtected(a)},q=c.startTimer(),r=g(f),s=q(),t=d.replace(/^\./,"",d.replace(/\//g,".",n)),u=d.replace(/^\./,"","".concat(e?e:"").concat(t,".").concat(f.name,"()"));return u=d.replace("/",".",u),k||c.send("state.action.complete",{name:u,action:o,mst:p,ms:s}),r})}function i(a){var b=d.pipe(d.map(d.when(d.isNil,d.always(""))),d.filter(d.endsWith(".*")),d.map(function(b){var c=d.slice(0,-2,b),g=e(c,a);return d.is(Object,g)&&!f(g)?d.pipe(d.keys,d.map(function(a){return"".concat(c,".").concat(a)}))(g||{}):[]}),d.concat(d.map(d.when(d.isNil,d.always("")),l)),d.flatten,d.reject(d.endsWith(".*")),d.uniq,d.sortBy(d.identity),d.map(function(b){return{path:b,value:f(b)?a:e(b,a)}}))(l);c.stateValuesChange(b)}var j={},k=!1,l=[],m=a.filter?a.filter:function(){return!0},n={"state.backup.request":function(a){var d=j[a.mstNodeName||"default"];if(d&&d.node){var e=b.getSnapshot(d.node);c.send("state.backup.response",{state:e})}},"state.restore.request":function(a){var c=j[a.mstNodeName||"default"],d=a&&a.payload&&a.payload.state;if(c&&c.node){var e=c.node;k=!0,b.applySnapshot(e,d),k=!1}},"state.action.dispatch":function(a){var c=j[a.mstNodeName||"default"],d=a&&a.payload&&a.payload.action;if(c&&c.node&&d){var e=c.node;try{b.applyAction(e,d)}catch(a){}}},"state.values.subscribe":function(c){var e=j[c.mstNodeName||"default"],f=c&&c.payload&&c.payload.paths||[];if(f&&(l=d.uniq(d.flatten(f))),e&&e.node){var g="snapshot"===a.queryMode?b.getSnapshot(e.node):e.node;i(g)}},"state.keys.request":function(a){var g=j[a.mstNodeName||"default"],h=a&&a.payload&&a.payload.path||[];if(g&&g.node&&h){var i=b.getSnapshot(g.node);if(f(h))c.stateKeysResponse(null,d.keys(i));else{var k=d.keys(e(h,i));c.stateKeysResponse(h,k)}}},"state.values.request":function(a){var d=j[a.mstNodeName||"default"],g=a&&a.payload&&a.payload.path||[];if(d&&d.node&&g){var h=b.getSnapshot(d.node);f(g)?c.stateValuesResponse(null,h):c.stateValuesResponse(g,e(g,h))}}};return{onCommand:function(a){var b=n[a&&a.type];b&&b(a)},features:{trackMstNode:function(a){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"default";if(!a)return{kind:"required"};if(j[c])return{kind:"already-tracking"};try{var d=b.getType(a);if(d.isType)try{return g(a),j[c]={node:a,modelType:d},{kind:"ok"}}catch(a){return{kind:"tracking-error",message:a.message}}else return{kind:"invalid-node"}}catch(a){return{kind:"invalid-node"}}}}}}},Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=reactotron-mst.umd.js.map
